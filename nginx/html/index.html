<script src="/keylines/js/keylines.js"></script>
<script src="/keylines/js/jquery-2.1.4.min.js"></script>
<link rel=" stylesheet" type="text/css" href="/keylines/css/keylines.css">

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
</head>
<body>
<div id="kl" style="width: 818 px; height: 586px;"></div>
<script>
    var chart;
    var rexsterURL = "http://glados49:8182/graphs/tumorgraph/";
    var startingGene = 'TG';
    var queryStr = "vertices?key=name&value=" + startingGene;

    var path = "/keylines/";

    window.onload = function () {
        KeyLines.paths({
            assets: path + 'assets/',
            flash:{
                swf: path + 'swf/keylines.swf',
                swfObject: path + 'js/swfobject.js',
                expressInstall: path + 'swf/expressInstall.swf'
            }
        });
        KeyLines.create('kl', function(err, chart) {
            $.ajax({
               type: "GET",
                url: rexsterURL + queryStr,
                dataType: "json",
                contentType: "application/json",
                success: function (json) {
                    ParseJSONData(json.results, chart);
                }
            });
        });
    };

    function ParseJSONData(items, callback) {
        var klItems = [];
        $.each(items, function (i, item) {
            var klItem;

            if(item._type === 'vertex') {
                klItem = createNode(item);
            } else {
                klItem = createLink(item);
            }

            klItems.push(klItem);
            //************************************
        });
        chart.expand(klItems, {tidy: true, animate: true}, callback);
    }

    function createNode(item){
        var node = {
            id: item._id,
            type: 'node',
            t: item.name,
            x: 150,
            y: 150,
            c: 'rgb(255, 0, 0)'
        };

        return node;
    }

    function createLink(item){
        var link = {};
        // add an id to the node using a custom ID (not the Titan internal one)
        link.id = item._id;

        return link;
    }

</script>
</body>
</html>